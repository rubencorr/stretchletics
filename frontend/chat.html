<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Stretchletics</title>
    <link rel="icon" type="image/png" href="/media/logo_round.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "neon-pink": "#EC4899",
              "neon-indigo": "#4F46E5",
              "deep-black": "#050505",
              "dark-charcoal": "#10141D",
              "deep-navy": "#1D2A4A",
            },
            boxShadow: {
              // Custom shadows are still defined, but the animation uses standard CSS
              "neon-pink":
                '0 0 20px theme("colors.neon-pink"), 0 0 60px theme("colors.neon-pink")',
              "neon-indigo":
                '0 0 20px theme("colors.neon-indigo"), 0 0 60px theme("colors.neon-indigo")',
              glass: "0 8px 32px 0 rgba(0, 0, 0, 0.37)",
            },
          },
        },
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap");
      :root {
        font-family: "Inter", sans-serif;
      }
      /* Enhanced Animated Background */
      body {
        position: relative;
        overflow-x: hidden;
      }
      
      /* Animated Gradient Overlay */
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
          radial-gradient(circle at 20% 30%, rgba(79, 70, 229, 0.15) 0%, transparent 50%),
          radial-gradient(circle at 80% 70%, rgba(236, 72, 153, 0.15) 0%, transparent 50%),
          radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 60%);
        animation: gradient-shift 15s ease infinite;
        z-index: 0;
        pointer-events: none;
      }

      /* Enhanced Moving Grid */
      body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          radial-gradient(circle, rgba(79, 70, 229, 0.03) 1px, transparent 1px),
          radial-gradient(circle, rgba(236, 72, 153, 0.03) 1px, transparent 1px);
        background-size: 50px 50px;
        background-position: 0 0, 25px 25px;
        z-index: 0;
        pointer-events: none;
        animation: grid-float 20s linear infinite;
      }

      @keyframes gradient-shift {
        0%, 100% {
          transform: translate(0, 0) scale(1);
          opacity: 1;
        }
        33% {
          transform: translate(10%, -10%) scale(1.1);
          opacity: 0.8;
        }
        66% {
          transform: translate(-10%, 10%) scale(0.9);
          opacity: 0.9;
        }
      }

      @keyframes grid-float {
        0% {
          transform: translate(0, 0);
        }
        100% {
          transform: translate(50px, 50px);
        }
      }

      /* Floating Orbs */
      .bg-orb {
        position: fixed;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.5;
        animation: float-orb 20s ease-in-out infinite;
        pointer-events: none;
        z-index: 0;
      }

      .bg-orb-1 {
        width: 300px;
        height: 300px;
        background: radial-gradient(circle, rgba(236, 72, 153, 0.4), transparent);
        top: -50px;
        left: -100px;
        animation-delay: 0s;
      }

      .bg-orb-2 {
        width: 250px;
        height: 250px;
        background: radial-gradient(circle, rgba(79, 70, 229, 0.4), transparent);
        bottom: -50px;
        right: -80px;
        animation-delay: 5s;
      }

      .bg-orb-3 {
        width: 200px;
        height: 200px;
        background: radial-gradient(circle, rgba(167, 139, 250, 0.3), transparent);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        animation-delay: 10s;
      }

      @keyframes float-orb {
        0%, 100% {
          transform: translate(0, 0) scale(1);
        }
        25% {
          transform: translate(20px, -30px) scale(1.1);
        }
        50% {
          transform: translate(-20px, 30px) scale(0.9);
        }
        75% {
          transform: translate(30px, 20px) scale(1.05);
        }
      }

      /* Ensure content is above background */
      body > div {
        position: relative;
        z-index: 1;
      }

      /* ---------------------------------- */
      /* --- 1. Neon Glow Keyframes CSS --- */
      /* ---------------------------------- */

      /* ---------------------------------- */
      /* --- 2. Element Styling --- */
      /* ---------------------------------- */

      /* Enhanced Glassmorphism Card */
      .glass-card {
        background: rgba(10, 10, 10, 0.75);
        backdrop-filter: blur(32px) saturate(200%);
        -webkit-backdrop-filter: blur(32px) saturate(200%);
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4),
                    0 0 80px rgba(79, 70, 229, 0.05);
        transition: all 0.5s ease-in-out;
      }

      /* Gradient Button Effect - Sleek Neon Plasma */
      .gradient-button {
        background-image: linear-gradient(
          to right,
          #4f46e5 0%,
          #ec4899 51%,
          #4f46e5 100%
        );
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
        background-size: 200% auto;
        color: white;
        border-radius: 8px;
        display: inline-block;
        position: relative;
        z-index: 1;
        box-shadow: 0 0 8px rgba(79, 70, 229, 0.3); /* Base glow */
      }
      .gradient-button:hover {
        background-position: right center;
        transform: translateY(-2px);
        box-shadow: 0 0 15px rgba(236, 72, 153, 0.4),
          0 0 25px rgba(79, 70, 229, 0.3);
      }

      /* Custom scrollbar for chat area */
      .chat-area::-webkit-scrollbar {
        width: 8px;
      }
      .chat-area::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 10px;
      }
      .chat-area::-webkit-scrollbar-thumb {
        background: rgba(236, 72, 153, 0.4);
        border-radius: 10px;
      }
      .chat-area::-webkit-scrollbar-thumb:hover {
        background: rgba(79, 70, 229, 0.6);
      }

      /* Custom scrollbar for parameters sidebar */
      .params-sidebar::-webkit-scrollbar {
        width: 6px;
      }
      .params-sidebar::-webkit-scrollbar-track {
        background: rgba(236, 72, 153, 0.05);
        border-radius: 10px;
      }
      .params-sidebar::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, #ec4899, #4f46e5);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .params-sidebar::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, #f472b6, #6366f1);
        box-shadow: 0 0 8px rgba(236, 72, 153, 0.4);
      }

      /* Custom scrollbar for parameters sidebar */
      .params-sidebar::-webkit-scrollbar {
        width: 6px;
      }
      .params-sidebar::-webkit-scrollbar-track {
        background: rgba(236, 72, 153, 0.05);
        border-radius: 10px;
      }
      .params-sidebar::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, #ec4899, #4f46e5);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .params-sidebar::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, #f472b6, #6366f1);
        box-shadow: 0 0 8px rgba(236, 72, 153, 0.4);
      }

      /* Hide scrollbar for quick examples */
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      /* User Message Bubble Style */
      .user-message-bubble {
        background: #ec4899; /* neon-pink */
        border-radius: 1rem 1rem 0.2rem 1rem;
        color: #050505; /* deep-black text */
        box-shadow: 0 4px 15px rgba(236, 72, 153, 0.2);
      }

      /* Bot Message Bubble Style */
      .bot-message-bubble {
        background: #1d2a4a; /* deep-navy */
        border: 1px solid rgba(79, 70, 229, 0.3);
        border-radius: 1rem 1rem 1rem 0.2rem;
        box-shadow: 0 4px 15px rgba(79, 70, 229, 0.2);
      }

      /* Custom Checkbox Styling */
      input[type="checkbox"] {
        appearance: none;
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        border: 2px solid rgba(236, 72, 153, 0.3);
        border-radius: 4px;
        background: rgba(0, 0, 0, 0.3);
        cursor: pointer;
        position: relative;
        transition: all 0.3s ease;
      }
      input[type="checkbox"]:hover {
        border-color: rgba(236, 72, 153, 0.6);
        box-shadow: 0 0 8px rgba(236, 72, 153, 0.3);
      }
      input[type="checkbox"]:checked {
        background: linear-gradient(135deg, #ec4899, #4f46e5);
        border-color: #ec4899;
        box-shadow: 0 0 12px rgba(236, 72, 153, 0.4);
      }
      input[type="checkbox"]:checked::after {
        content: 'âœ“';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 12px;
        font-weight: bold;
      }

      /* Range Slider Styling */
      input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: linear-gradient(to right, #ec4899 0%, #4f46e5 100%);
        outline: none;
        cursor: pointer;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ec4899, #4f46e5);
        cursor: pointer;
        box-shadow: 0 0 12px rgba(236, 72, 153, 0.6);
        transition: all 0.2s ease;
      }
      input[type="range"]::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 0 20px rgba(236, 72, 153, 0.8);
      }
      input[type="range"]::-moz-range-thumb {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ec4899, #4f46e5);
        cursor: pointer;
        border: none;
        box-shadow: 0 0 12px rgba(236, 72, 153, 0.6);
        transition: all 0.2s ease;
      }
      input[type="range"]::-moz-range-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 0 20px rgba(236, 72, 153, 0.8);
      }

      /* Typing Indicator */
      .typing-indicator {
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .typing-indicator span {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #4f46e5;
        animation: typing-bounce 1.4s infinite;
        display: inline-block;
      }
      .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
      }
      @keyframes typing-bounce {
        0%, 60%, 100% { transform: translateY(0); opacity: 0.7; }
        30% { transform: translateY(-10px); opacity: 1; }
      }

      /* Action Buttons */
      .action-btn {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 6px 12px;
        border-radius: 6px;
        transition: all 0.2s ease;
        cursor: pointer;
        font-size: 12px;
      }
      .action-btn:hover {
        background: rgba(236, 72, 153, 0.2);
        border-color: rgba(236, 72, 153, 0.5);
        transform: translateY(-1px);
      }
      .action-btn.success {
        background: rgba(34, 197, 94, 0.2);
        border-color: rgba(34, 197, 94, 0.5);
      }

      /* History Sidebar */
      .history-sidebar {
        position: fixed;
        left: -320px;
        top: 0;
        width: 320px;
        height: 100vh;
        background: rgba(10, 10, 10, 0.95);
        backdrop-filter: blur(32px);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
        transition: left 0.3s ease;
        z-index: 1000;
        overflow-y: auto;
      }
      .history-sidebar.open {
        left: 0;
      }
      .history-item {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.08);
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .history-item:hover {
        background: rgba(79, 70, 229, 0.15);
        border-color: rgba(79, 70, 229, 0.3);
        transform: translateX(4px);
      }
      .burger-menu {
        position: fixed;
        top: 16px;
        left: 20px;
        z-index: 1001;
        width: 40px;
        height: 40px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }
      .burger-menu:hover {
        transform: scale(1.1);
        color: #ec4899;
      }

      /* Example chip styling */
      .example-chip {
        background: rgba(236, 72, 153, 0.1);
        border: 1px solid rgba(236, 72, 153, 0.3);
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .example-chip:hover {
        background: rgba(236, 72, 153, 0.2);
        border-color: rgba(236, 72, 153, 0.6);
        transform: scale(1.05);
      }

      /* Select dropdown styling */
      select {
        background-color: #1a1a1a !important;
        color: white !important;
      }

      select option {
        background-color: #1a1a1a !important;
        color: white !important;
      }

      select option:checked {
        background-color: #4f46e5 !important;
        color: white !important;
      }

      /* Quick Action Chips */
      .example-chip {
        background: rgba(79, 70, 229, 0.2);
        border: 1px solid rgba(79, 70, 229, 0.3);
        transition: all 0.2s ease;
      }
      .example-chip:hover {
        background: rgba(236, 72, 153, 0.3);
        border-color: rgba(236, 72, 153, 0.5);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
      }

      /* Routine Card Styling */
      .routine-card {
        background: rgba(79, 70, 229, 0.1);
        border: 1px solid rgba(79, 70, 229, 0.3);
        border-radius: 12px;
        margin-top: 12px;
        overflow: hidden;
        transition: all 0.3s ease;
      }
      .routine-card:hover {
        border-color: rgba(236, 72, 153, 0.4);
        box-shadow: 0 4px 20px rgba(79, 70, 229, 0.2);
      }
      .routine-header {
        cursor: pointer;
        padding: 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(0, 0, 0, 0.3);
        transition: background 0.2s ease;
      }
      .routine-header:hover {
        background: rgba(0, 0, 0, 0.5);
      }
      .routine-content {
        padding: 16px;
        display: none;
      }
      .routine-content.expanded {
        display: block;
      }

      /* Timestamp styling */
      .message-timestamp {
        font-size: 10px;
        color: rgba(255, 255, 255, 0.3);
        margin-top: 4px;
      }

      /* Voice input button */
      .voice-btn {
        background: rgba(236, 72, 153, 0.2);
        border: 1px solid rgba(236, 72, 153, 0.3);
        transition: all 0.2s ease;
      }
      .voice-btn:hover {
        background: rgba(236, 72, 153, 0.3);
        border-color: rgba(236, 72, 153, 0.5);
        transform: scale(1.05);
      }
      .voice-btn.listening {
        background: rgba(239, 68, 68, 0.3);
        border-color: rgba(239, 68, 68, 0.5);
        animation: pulse 1.5s infinite;
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
      }
    </style>
  </head>

  <body class="bg-[#050505] text-slate-300 antialiased h-screen overflow-hidden p-4 pb-3">
    <!-- Floating background orbs -->
    <div class="bg-orb bg-orb-1"></div>
    <div class="bg-orb bg-orb-2"></div>
    <div class="bg-orb bg-orb-3"></div>
    
    <!-- Burger Menu -->
    <button id="burger-menu" class="burger-menu">
      <i class="fa-solid fa-bars text-white text-lg"></i>
    </button>

    <!-- History Sidebar -->
    <div id="history-sidebar" class="history-sidebar">
      <div class="p-6 pl-16">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-black text-white uppercase tracking-wider">History</h2>
          <button id="close-history" class="text-slate-400 hover:text-white transition">
            <i class="fa-solid fa-times text-xl"></i>
          </button>
        </div>
        <div id="history-list" class="space-y-3">
          <p class="text-sm text-slate-500 italic text-center py-8">No chat history yet</p>
        </div>
        <button id="clear-history" class="w-full mt-6 px-4 py-2 bg-red-500/20 border border-red-500/30 rounded-lg text-red-400 text-sm font-bold hover:bg-red-500/30 transition">
          <i class="fa-solid fa-trash mr-2"></i>Clear All History
        </button>
      </div>
    </div>
    
    <div class="w-full h-full flex flex-col">
      <!-- Header moved to top-left -->
      <div class="flex items-center justify-between mb-3 pl-16">
        <h1 class="text-2xl font-black tracking-wider text-white uppercase">
          <i class="fa-solid fa-sparkles text-neon-pink mr-2"></i>Stretchletics
        </h1>
      </div>

      <!-- Unified Single Window -->
      <div class="rounded-xl overflow-hidden flex-grow flex h-full">
        <!-- LEFT SIDEBAR: PARAMETERS -->
        <div class="params-sidebar w-64 overflow-y-auto p-5" style="background: rgba(10, 10, 10, 0.7); backdrop-filter: blur(20px); border-right: 1px solid rgba(236, 72, 153, 0.15); box-shadow: inset -1px 0 20px rgba(236, 72, 153, 0.05);">
          <h2
            class="text-base font-black text-white uppercase mb-5 tracking-wider"
          >
          </h2>

          <!-- Routine Type -->
          <div class="mb-6">
            <label
              class="block text-sm font-bold text-slate-300 mb-2 uppercase tracking-wider"
              >Routine Type</label
            >
            <select
              id="routine-type-input"
              class="w-full p-3 rounded-lg border border-white/10 bg-white/5 text-white focus:ring-2 focus:ring-neon-pink focus:border-transparent transition duration-300 outline-none"
            >
              <option value="warm-up">Warm-Up</option>
              <option value="cool-down" selected>Stretching</option>
            </select>
          </div>

          <!-- Duration -->
          <div class="mb-6">
            <div class="flex justify-between items-center mb-2">
              <label class="text-sm font-bold text-slate-300 uppercase tracking-wider">Duration</label>
              <span id="duration-display" class="text-sm text-neon-pink font-bold">10 min</span>
            </div>
            <input
              type="range"
              id="duration-input"
              min="5"
              max="60"
              value="10"
              step="5"
              class="w-full"
            />
          </div>

          <!-- Difficulty Level -->
          <div class="mb-6">
            <label
              class="block text-sm font-bold text-slate-300 mb-2 uppercase tracking-wider"
              >Difficulty</label
            >
            <select
              id="difficulty-input"
              class="w-full p-3 rounded-lg border border-white/10 bg-white/5 text-white focus:ring-2 focus:ring-neon-pink focus:border-transparent transition duration-300 outline-none"
            >
              <option value="beginner" selected>Beginner</option>
              <option value="intermediate">Intermediate</option>
              <option value="advanced">Advanced</option>
            </select>
          </div>

          <!-- Equipment Available -->
          <div class="mb-6">
            <label
              class="block text-sm font-bold text-slate-300 mb-3 uppercase tracking-wider"
              >Equipment</label
            >
            <div class="space-y-2">
              <label class="flex items-center">
                <input
                  type="checkbox"
                  id="equipment-roller"
                  class="w-4 h-4 rounded"
                />
                <span class="ml-2 text-sm">Foam Roller</span>
              </label>
              <label class="flex items-center">
                <input
                  type="checkbox"
                  id="equipment-bands"
                  class="w-4 h-4 rounded"
                />
                <span class="ml-2 text-sm">Resistance Bands</span>
              </label>
              <label class="flex items-center">
                <input
                  type="checkbox"
                  id="equipment-mat"
                  class="w-4 h-4 rounded"
                />
                <span class="ml-2 text-sm">Yoga Mat</span>
              </label>
              <label class="flex items-center">
                <input
                  type="checkbox"
                  id="equipment-ball"
                  class="w-4 h-4 rounded"
                />
                <span class="ml-2 text-sm">Stability Ball</span>
              </label>
              <label class="flex items-center">
                <input
                  type="checkbox"
                  id="equipment-massage"
                  class="w-4 h-4 rounded"
                />
                <span class="ml-2 text-sm">Massage Ball</span>
              </label>
            </div>
          </div>

          <!-- Focus Areas -->
          <div class="mb-6">
            <label
              class="block text-sm font-bold text-slate-300 mb-3 uppercase tracking-wider"
              >Focus Areas</label
            >
            <div class="space-y-2">
              <label class="flex items-center">
                <input
                  type="checkbox"
                  id="focus-upper"
                  class="w-4 h-4 rounded"
                />
                <span class="ml-2 text-sm">Upper Body</span>
              </label>
              <label class="flex items-center">
                <input
                  type="checkbox"
                  id="focus-lower"
                  class="w-4 h-4 rounded"
                />
                <span class="ml-2 text-sm">Lower Body</span>
              </label>
              <label class="flex items-center">
                <input
                  type="checkbox"
                  id="focus-core"
                  class="w-4 h-4 rounded"
                />
                <span class="ml-2 text-sm">Core</span>
              </label>
              <label class="flex items-center">
                <input
                  type="checkbox"
                  id="focus-full"
                  class="w-4 h-4 rounded"
                />
                <span class="ml-2 text-sm">Full Body</span>
              </label>
            </div>
          </div>

          <!-- Injuries/Restrictions -->
          <div class="mb-6">
            <label
              class="block text-sm font-bold text-slate-300 mb-2 uppercase tracking-wider"
              >Restrictions</label
            >
            <textarea
              id="restrictions-input"
              placeholder="Any injuries or restrictions..."
              class="w-full p-3 rounded-lg border border-white/10 bg-white/5 text-white placeholder-slate-500 focus:ring-2 focus:ring-neon-pink focus:border-transparent transition duration-300 outline-none text-sm"
              rows="3"
            ></textarea>
          </div>
        </div>

        <!-- RIGHT SIDE: CHAT -->
        <div class="flex-grow flex flex-col overflow-hidden" style="background: rgba(0, 0, 0, 0.2); backdrop-filter: blur(8px);">
          <div
            id="chat-messages"
            class="chat-area p-6 space-y-6 overflow-y-auto flex-1"
          >
            <!-- Welcome Message -->
            <div class="flex justify-start">
              <div class="bot-message-bubble p-4 max-w-2xl">
                <p class="font-bold text-neon-indigo uppercase text-xs tracking-wider">
                  <i class="fa-solid fa-sparkles mr-1"></i> Stretchletics
                </p>
                <p class="mt-1.5 text-sm leading-snug">
                  Welcome! I'll create personalized stretching routines based on your workouts and goals.
                </p>
                <div class="mt-3 pt-3 border-t border-white/10">
                  <p class="text-xs text-slate-400 mb-2 font-bold uppercase tracking-wider">Quick Examples:</p>
                  <div class="flex gap-2 overflow-x-auto scrollbar-hide">
                    <button class="example-chip px-3 py-1.5 rounded-full text-xs font-medium text-white whitespace-nowrap flex-shrink-0">
                      <i class="fa-solid fa-person-running mr-1"></i> Post-run cooldown
                    </button>
                    <button class="example-chip px-3 py-1.5 rounded-full text-xs font-medium text-white whitespace-nowrap flex-shrink-0">
                      <i class="fa-solid fa-dumbbell mr-1"></i> Upper body stretch
                    </button>
                    <button class="example-chip px-3 py-1.5 rounded-full text-xs font-medium text-white whitespace-nowrap flex-shrink-0">
                      <i class="fa-solid fa-bed mr-1"></i> Morning mobility
                    </button>
                    <button class="example-chip px-3 py-1.5 rounded-full text-xs font-medium text-white whitespace-nowrap flex-shrink-0">
                      <i class="fa-solid fa-briefcase mr-1"></i> Desk worker relief
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="pt-2 pb-4 px-4 border-t border-white/5 bg-black/20">
            <div class="flex items-center space-x-3 mb-4">
              <button
                id="last-workout-btn"
                class="gradient-button flex-shrink-0 px-4 py-3 text-sm font-bold tracking-wider"
              >
                <i class="fa-solid fa-rotate inline-block mr-2"></i>
                Sync Last Workout
              </button>
              <div
                id="last-workout-status"
                class="text-xs text-slate-500 italic flex-grow truncate"
              >
                (Ready to sync)
              </div>
            </div>

            <form id="chat-form" class="flex space-x-2">
              <input
                type="text"
                id="chat-input"
                required
                placeholder="Ask me for a routine..."
                class="flex-grow h-12 px-4 rounded-lg border border-white/10 bg-white/5 text-white placeholder-slate-500 focus:ring-2 focus:ring-neon-pink focus:border-transparent transition duration-300 outline-none shadow-inner"
              />
              <button
                type="button"
                id="voice-button"
                class="voice-btn flex-shrink-0 w-12 h-12 rounded-lg flex items-center justify-center"
                title="Voice input"
              >
                <i class="fa-solid fa-microphone"></i>
              </button>
              <button
                type="submit"
                id="send-button"
                class="gradient-button flex-shrink-0 w-12 h-12 text-base font-bold flex items-center justify-center"
              >
                <i class="fa-solid fa-paper-plane"></i>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      const chatMessages = document.getElementById("chat-messages");
      const chatForm = document.getElementById("chat-form");
      const chatInput = document.getElementById("chat-input");
      const sendButton = document.getElementById("send-button");
      const lastWorkoutBtn = document.getElementById("last-workout-btn");
      const lastWorkoutStatus = document.getElementById("last-workout-status");

      // Parameter inputs
      const routineTypeInput = document.getElementById("routine-type-input");
      const durationInput = document.getElementById("duration-input");
      const difficultyInput = document.getElementById("difficulty-input");
      const restrictionsInput = document.getElementById("restrictions-input");

      // --- Mock Data ---
      const mockLastWorkout = {
        type: "Running",
        duration: "1 hour 15 minutes",
        intensity: "Moderate",
        muscleGroupsUsed: [
          "Quadriceps",
          "Hamstrings",
          "Glutes",
          "Calves",
          "Core",
        ],
        date: new Date().toLocaleDateString(),
        distance: "12 km",
      };

      // --- Helper Functions ---

      function scrollToBottom() {
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      let lastUserPrompt = '';

      function addMessage(text, sender = "bot", isRoutine = false) {
        const messageWrapper = document.createElement("div");
        const messageBox = document.createElement("div");
        const timestamp = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

        if (sender === "user") {
          lastUserPrompt = text;
          messageWrapper.className = "flex justify-end";
          messageBox.className = "p-3 max-w-xs sm:max-w-md user-message-bubble";
          const textEl = document.createElement('p');
          textEl.className = 'text-sm';
          textEl.textContent = text;
          const timeEl = document.createElement('div');
          timeEl.className = 'message-timestamp text-right';
          timeEl.textContent = timestamp;
          messageBox.appendChild(textEl);
          messageBox.appendChild(timeEl);
        } else {
          messageWrapper.className = "flex justify-start";
          messageBox.className = "p-4 w-full max-w-4xl bot-message-bubble";

          const senderTag = document.createElement("p");
          senderTag.className =
            "font-bold uppercase text-xs tracking-wider " +
            (isRoutine ? "text-neon-pink" : "text-neon-indigo");
          senderTag.innerHTML = isRoutine
            ? '<i class="fa-solid fa-fire mr-1"></i> Stretchletics'
            : '<i class="fa-solid fa-robot mr-1"></i> Stretchletics';

          const messageContent = document.createElement("div");
          messageContent.className = "mt-2";
          
          if (isRoutine) {
            // Create expandable routine card
            const routineCard = document.createElement('div');
            routineCard.className = 'routine-card';
            
            const routineHeader = document.createElement('div');
            routineHeader.className = 'routine-header';
            routineHeader.innerHTML = `
              <div>
                <p class="text-white font-bold text-sm"><i class="fa-solid fa-list-check mr-2"></i>Your Personalized Routine</p>
                <p class="text-xs text-slate-400 mt-1">Click to expand/collapse</p>
              </div>
              <i class="fa-solid fa-chevron-down text-neon-pink transition-transform duration-300"></i>
            `;
            
            const routineContent = document.createElement('div');
            routineContent.className = 'routine-content expanded text-sm';
            routineContent.innerHTML = text.replace(
              /\*\*(.*?)\*\*/g,
              "<strong class='text-white'>$1</strong>"
            ).replace(/\n/g, '<br>');
            
            routineHeader.onclick = function() {
              routineContent.classList.toggle('expanded');
              const icon = routineHeader.querySelector('i.fa-chevron-down');
              icon.style.transform = routineContent.classList.contains('expanded') ? 'rotate(180deg)' : 'rotate(0deg)';
            };
            
            // Set initial icon rotation to expanded state
            setTimeout(() => {
              const icon = routineHeader.querySelector('i.fa-chevron-down');
              icon.style.transform = 'rotate(180deg)';
            }, 0);
            
            routineCard.appendChild(routineHeader);
            routineCard.appendChild(routineContent);
            messageContent.appendChild(routineCard);
          } else {
            messageContent.className += ' text-sm whitespace-pre-wrap message-content';
            messageContent.innerHTML = text.replace(
              /\*\*(.*?)\*\*/g,
              "<strong class='text-white'>$1</strong>"
            );
          }
          
          const timeEl = document.createElement('div');
          timeEl.className = 'message-timestamp';
          timeEl.textContent = timestamp;

          messageBox.appendChild(senderTag);
          messageBox.appendChild(messageContent);
          messageBox.appendChild(timeEl);
          
          // Add action buttons for bot messages
          const actionsDiv = document.createElement('div');
          actionsDiv.className = 'mt-4 pt-3 border-t border-white/10 flex gap-2 flex-wrap';
          actionsDiv.innerHTML = `
            <button class="action-btn" onclick="copyMessage(this)" title="Copy to clipboard">
              <i class="fa-solid fa-copy mr-1"></i> Copy
            </button>
            <button class="action-btn" onclick="downloadMessage(this)" title="Download as text file">
              <i class="fa-solid fa-download mr-1"></i> Download
            </button>
            <button class="action-btn" onclick="shareMessage(this)" title="Share message">
              <i class="fa-solid fa-share-nodes mr-1"></i> Share
            </button>
          `;
          messageBox.appendChild(actionsDiv);
          
          // Save to history if it's a routine
          if (isRoutine && lastUserPrompt) {
            saveToHistory(lastUserPrompt, text);
          }
        }

        messageWrapper.appendChild(messageBox);
        chatMessages.appendChild(messageWrapper);
        scrollToBottom();
      }

      // Copy message to clipboard
      window.copyMessage = function(btn) {
        const messageText = btn.closest('.bot-message-bubble').querySelector('.message-content').innerText;
        navigator.clipboard.writeText(messageText).then(() => {
          const originalHTML = btn.innerHTML;
          btn.innerHTML = '<i class="fa-solid fa-check mr-1"></i> Copied!';
          btn.classList.add('success');
          setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.classList.remove('success');
          }, 2000);
        });
      }

      // Download message as text file
      window.downloadMessage = function(btn) {
        const messageText = btn.closest('.bot-message-bubble').querySelector('.message-content').innerText;
        const blob = new Blob([messageText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `stretchletics-routine-${Date.now()}.txt`;
        a.click();
        URL.revokeObjectURL(url);
        
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-check mr-1"></i> Downloaded!';
        btn.classList.add('success');
        setTimeout(() => {
          btn.innerHTML = originalHTML;
          btn.classList.remove('success');
        }, 2000);
      }

      // Share message
      window.shareMessage = function(btn) {
        const messageText = btn.closest('.bot-message-bubble').querySelector('.message-content').innerText;
        if (navigator.share) {
          navigator.share({
            title: 'My Stretchletics Routine',
            text: messageText
          }).catch(() => {});
        } else {
          navigator.clipboard.writeText(messageText);
          const originalHTML = btn.innerHTML;
          btn.innerHTML = '<i class="fa-solid fa-check mr-1"></i> Copied!';
          btn.classList.add('success');
          setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.classList.remove('success');
          }, 2000);
        }
      }

      function toggleForm(enabled) {
        chatInput.disabled = !enabled;
        sendButton.disabled = !enabled;
        lastWorkoutBtn.disabled = !enabled;
        chatInput.placeholder = enabled
          ? "Ask me for a routine..."
          : "Generating routine...";

        // Show/hide typing indicator dynamically
        let typingIndicator = document.getElementById('typing-indicator');
        if (!enabled) {
          // Remove old indicator if exists
          if (typingIndicator) typingIndicator.remove();
          
          // Create and append new typing indicator at the end
          typingIndicator = document.createElement('div');
          typingIndicator.id = 'typing-indicator';
          typingIndicator.className = 'flex justify-start';
          typingIndicator.innerHTML = `
            <div class="bot-message-bubble p-4">
              <div class="typing-indicator">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          `;
          chatMessages.appendChild(typingIndicator);
          scrollToBottom();
        } else {
          // Remove typing indicator
          if (typingIndicator) typingIndicator.remove();
        }

        // Change button icon/state when disabled (loading)
        sendButton.innerHTML = enabled
          ? '<i class="fa-solid fa-paper-plane"></i>'
          : `<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
      }

      // --- LLM/Routine Generation via Backend ---
      async function generateRoutine(prompt) {
        chatInput.value = "";
        toggleForm(false);

        try {
          // Gather selected equipment
          const equipment = [];
          if (document.getElementById("equipment-roller").checked)
            equipment.push("Foam Roller");
          if (document.getElementById("equipment-bands").checked)
            equipment.push("Resistance Bands");
          if (document.getElementById("equipment-mat").checked)
            equipment.push("Yoga Mat");
          if (document.getElementById("equipment-ball").checked)
            equipment.push("Stability Ball");
          if (document.getElementById("equipment-massage").checked)
            equipment.push("Massage Ball");

          // Gather focus areas
          const focusAreas = [];
          if (document.getElementById("focus-upper").checked)
            focusAreas.push("Upper Body");
          if (document.getElementById("focus-lower").checked)
            focusAreas.push("Lower Body");
          if (document.getElementById("focus-core").checked)
            focusAreas.push("Core");
          if (document.getElementById("focus-full").checked)
            focusAreas.push("Full Body");

          // Build enhanced prompt with parameters
          const routineType = routineTypeInput.value;
          const duration = durationInput.value;
          const difficulty = difficultyInput.value;
          const restrictions = restrictionsInput.value;

          const enhancedPrompt = `${prompt}

Additional Parameters:
- Routine Type: ${routineType}
- Duration: ${duration} minutes
- Difficulty Level: ${difficulty}
${equipment.length > 0 ? `- Equipment Available: ${equipment.join(", ")}` : ""}
${focusAreas.length > 0 ? `- Focus Areas: ${focusAreas.join(", ")}` : ""}
${restrictions ? `- Restrictions/Injuries: ${restrictions}` : ""}`;

          const response = await fetch("http://127.0.0.1:5500/api/chat", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ message: enhancedPrompt }),
          });

          if (!response.ok) {
            throw new Error(`Server error: ${response.status}`);
          }

          const data = await response.json();
          const routineText = data.response;

          addMessage(routineText, "bot", true);
        } catch (error) {
          addMessage(
            `Error generating routine: ${error.message}`,
            "bot",
            false
          );
        }

        toggleForm(true);
        chatInput.value = "";
      }

      // --- Event Listeners ---

      // 1. Handle LLM Chat Request
      chatForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const prompt = chatInput.value.trim();
        if (prompt) {
          addMessage(prompt, "user");
          generateRoutine(prompt);
        }
      });

      // 2. Handle Last Workout Button Click
      lastWorkoutBtn.addEventListener("click", () => {
        const workout = mockLastWorkout;
        const routineType = routineTypeInput.value;
        const routineLabel = routineType === "warm-up" ? "warm-up" : "cool-down";
        const userPrompt = `Generate a ${routineLabel} routine for my last workout: a ${workout.type} of ${workout.duration}.`;

        addMessage(userPrompt, "user");

        // Trigger the routine generation via backend
        generateRoutine(userPrompt);
      });

      // Chat history storage
      let chatHistory = JSON.parse(localStorage.getItem('chatHistory') || '[]');

      // Save to history
      function saveToHistory(userPrompt, botResponse) {
        const historyItem = {
          id: Date.now(),
          userPrompt: userPrompt,
          preview: userPrompt.substring(0, 50) + (userPrompt.length > 50 ? '...' : ''),
          response: botResponse,
          timestamp: new Date().toLocaleString()
        };
        chatHistory.unshift(historyItem);
        if (chatHistory.length > 20) chatHistory.pop();
        localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
        renderHistory();
      }

      // Render history
      function renderHistory() {
        const historyList = document.getElementById('history-list');
        if (chatHistory.length === 0) {
          historyList.innerHTML = '<p class="text-sm text-slate-500 italic text-center py-8">No chat history yet</p>';
          return;
        }
        historyList.innerHTML = chatHistory.map(item => `
          <div class="history-item p-4 rounded-lg" data-id="${item.id}">
            <p class="text-sm font-medium text-white truncate">${item.preview}</p>
            <p class="text-xs text-slate-500 mt-1">${item.timestamp}</p>
          </div>
        `).join('');
        
        document.querySelectorAll('.history-item').forEach(item => {
          item.addEventListener('click', () => {
            const id = parseInt(item.dataset.id);
            const histItem = chatHistory.find(h => h.id === id);
            if (histItem) {
              addMessage(histItem.userPrompt, 'user');
              addMessage(histItem.response, 'bot', true);
              document.getElementById('history-sidebar').classList.remove('open');
            }
          });
        });
      }

      // --- Initialization ---
      document.addEventListener("DOMContentLoaded", () => {
        // Update status with mock data
        lastWorkoutStatus.textContent = `(Last Synced Workout: ${mockLastWorkout.type} on ${mockLastWorkout.date} - ${mockLastWorkout.distance})`;
        
        // Duration slider update
        const durationInput = document.getElementById('duration-input');
        const durationDisplay = document.getElementById('duration-display');
        durationInput.addEventListener('input', (e) => {
          durationDisplay.textContent = e.target.value + ' min';
        });
        
        // Voice input functionality
        const voiceButton = document.getElementById('voice-button');
        let recognition = null;
        
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
          const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
          recognition = new SpeechRecognition();
          recognition.continuous = false;
          recognition.interimResults = false;
          recognition.lang = 'en-US';
          
          recognition.onstart = () => {
            voiceButton.classList.add('listening');
            voiceButton.innerHTML = '<i class="fa-solid fa-circle text-red-500"></i>';
          };
          
          recognition.onend = () => {
            voiceButton.classList.remove('listening');
            voiceButton.innerHTML = '<i class="fa-solid fa-microphone"></i>';
          };
          
          recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            chatInput.value = transcript;
            chatInput.focus();
          };
          
          recognition.onerror = (event) => {
            console.error('Speech recognition error:', event.error);
            voiceButton.classList.remove('listening');
            voiceButton.innerHTML = '<i class="fa-solid fa-microphone"></i>';
          };
          
          voiceButton.addEventListener('click', () => {
            if (voiceButton.classList.contains('listening')) {
              recognition.stop();
            } else {
              recognition.start();
            }
          });
        } else {
          voiceButton.style.display = 'none'; // Hide if not supported
        }

        // Quick prompt function - auto send
        window.useQuickPrompt = function(btn) {
          const text = btn.textContent.trim();
          chatInput.value = text;
          addMessage(text, "user");
          generateRoutine(text);
          chatInput.value = '';
        };
        
        // Example chips click handlers - auto send all chips
        document.querySelectorAll('.example-chip').forEach(chip => {
          chip.addEventListener('click', () => {
            const text = chip.textContent.trim();
            addMessage(text, "user");
            generateRoutine(text);
          });
        });

        // Burger menu toggle
        const burgerMenu = document.getElementById('burger-menu');
        const historySidebar = document.getElementById('history-sidebar');
        const closeHistory = document.getElementById('close-history');
        
        burgerMenu.addEventListener('click', () => {
          historySidebar.classList.toggle('open');
        });
        
        closeHistory.addEventListener('click', () => {
          historySidebar.classList.remove('open');
        });

        // Clear history
        document.getElementById('clear-history').addEventListener('click', () => {
          if (confirm('Clear all chat history?')) {
            chatHistory = [];
            localStorage.removeItem('chatHistory');
            renderHistory();
          }
        });

        // Initial history render
        renderHistory();
      });
    </script>
  </body>
</html>
