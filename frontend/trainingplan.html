<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Training Plan - Stretchletics</title>
    <link rel="icon" type="image/png" href="/media/logo_round.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "neon-pink": "#EC4899",
              "neon-indigo": "#4F46E5",
              "deep-black": "#050505",
              "dark-charcoal": "#10141D",
              "deep-navy": "#1D2A4A",
            },
          },
        },
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap");
      :root {
        font-family: "Inter", sans-serif;
      }

      /* Floating Orbs */
      .bg-orb {
        position: fixed;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.5;
        animation: float-orb 20s ease-in-out infinite;
        pointer-events: none;
        z-index: 0;
      }

      .bg-orb-1 {
        width: 300px;
        height: 300px;
        background: radial-gradient(circle, rgba(236, 72, 153, 0.4), transparent);
        top: -50px;
        left: -100px;
      }

      .bg-orb-2 {
        width: 250px;
        height: 250px;
        background: radial-gradient(circle, rgba(79, 70, 229, 0.4), transparent);
        bottom: -50px;
        right: -80px;
        animation-delay: 5s;
      }

      @keyframes float-orb {
        0%, 100% { transform: translate(0, 0) scale(1); }
        25% { transform: translate(20px, -30px) scale(1.1); }
        50% { transform: translate(-20px, 30px) scale(0.9); }
        75% { transform: translate(30px, 20px) scale(1.05); }
      }

      /* Wizard Overlay */
      .wizard-overlay {
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(10px);
      }

      .wizard-card {
        background: rgba(10, 10, 10, 0.95);
        backdrop-filter: blur(32px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      }

      /* Sport Selection Cards */
      .sport-card {
        background: rgba(255, 255, 255, 0.03);
        border: 2px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .sport-card:hover {
        border-color: rgba(236, 72, 153, 0.5);
        background: rgba(236, 72, 153, 0.1);
        transform: translateY(-4px);
      }

      .sport-card.selected {
        border-color: #ec4899;
        background: rgba(236, 72, 153, 0.2);
        box-shadow: 0 0 20px rgba(236, 72, 153, 0.3);
      }

      /* Calendar View Styling */
      .calendar-day {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        min-height: 120px;
        transition: all 0.2s ease;
      }

      .calendar-day:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(236, 72, 153, 0.3);
      }

      .calendar-day.has-workout {
        border-color: rgba(236, 72, 153, 0.4);
        background: rgba(236, 72, 153, 0.05);
      }

      .workout-badge {
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 4px;
        background: rgba(236, 72, 153, 0.2);
        border: 1px solid rgba(236, 72, 153, 0.4);
      }

      /* Gradient Button */
      .gradient-button {
        background-image: linear-gradient(to right, #4F46E5 0%, #EC4899 51%, #4F46E5 100%);
        background-size: 200% auto;
        transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
      }

      .gradient-button:hover {
        background-position: right center;
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(236, 72, 153, 0.4);
      }

      /* Range Slider */
      input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: linear-gradient(to right, #ec4899 0%, #4f46e5 100%);
        outline: none;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ec4899, #4f46e5);
        cursor: pointer;
        box-shadow: 0 0 12px rgba(236, 72, 153, 0.6);
      }

      input[type="range"]::-moz-range-thumb {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ec4899, #4f46e5);
        cursor: pointer;
        border: none;
        box-shadow: 0 0 12px rgba(236, 72, 153, 0.6);
      }

      /* Plan Display */
      .plan-content {
        line-height: 1.8;
      }

      .plan-content h2, .plan-content h3 {
        color: #ec4899;
        font-weight: 800;
        text-transform: uppercase;
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
      }

      .plan-content strong {
        color: #ffffff;
      }
    </style>
  </head>

  <body class="bg-deep-black text-slate-300 antialiased h-screen overflow-hidden">
    <!-- Floating background orbs -->
    <div class="bg-orb bg-orb-1"></div>
    <div class="bg-orb bg-orb-2"></div>

    <!-- Wizard Overlay -->
    <div id="wizard-overlay" class="wizard-overlay fixed inset-0 z-50 flex items-center justify-center p-4">
      <div class="wizard-card rounded-3xl p-8 max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <h1 class="text-4xl font-black text-white uppercase tracking-wider mb-2 text-center">
          <i class="fa-solid fa-calendar-days text-neon-pink mr-3"></i>
          Create Your Training Plan
        </h1>
        <p class="text-slate-400 text-center mb-8">Customize your plan to reach your goals</p>

        <!-- Sport Selection -->
        <div class="mb-8">
          <label class="block text-sm font-bold text-slate-300 uppercase tracking-wider mb-4">
            Select Your Sport
          </label>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="sport-card rounded-xl p-6 text-center" data-sport="running">
              <i class="fas fa-running text-4xl text-neon-pink mb-3"></i>
              <p class="text-sm font-semibold">Running</p>
            </div>
            <div class="sport-card rounded-xl p-6 text-center" data-sport="cycling">
              <i class="fas fa-biking text-4xl text-neon-indigo mb-3"></i>
              <p class="text-sm font-semibold">Cycling</p>
            </div>
            <div class="sport-card rounded-xl p-6 text-center" data-sport="swimming">
              <i class="fas fa-person-swimming text-4xl text-cyan-400 mb-3"></i>
              <p class="text-sm font-semibold">Swimming</p>
            </div>
            <div class="sport-card rounded-xl p-6 text-center" data-sport="triathlon">
              <i class="fas fa-medal text-4xl text-yellow-400 mb-3"></i>
              <p class="text-sm font-semibold">Triathlon</p>
            </div>
          </div>
        </div>

        <!-- Current & Goal Performance -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
          <div>
            <label class="block text-sm font-bold text-slate-300 uppercase tracking-wider mb-2">
              Current Performance
            </label>
            <input
              type="text"
              id="current-time"
              placeholder="e.g., 45:00 for 10K"
              class="w-full p-3 rounded-xl bg-black/50 border border-white/10 text-white focus:ring-2 focus:ring-neon-pink focus:border-transparent transition outline-none"
            />
            <p class="text-xs text-slate-500 mt-1">Enter your current best time or distance</p>
          </div>
          <div>
            <label class="block text-sm font-bold text-slate-300 uppercase tracking-wider mb-2">
              Goal Performance
            </label>
            <input
              type="text"
              id="goal-time"
              placeholder="e.g., 40:00 for 10K"
              class="w-full p-3 rounded-xl bg-black/50 border border-white/10 text-white focus:ring-2 focus:ring-neon-pink focus:border-transparent transition outline-none"
            />
            <p class="text-xs text-slate-500 mt-1">Enter your target time or distance</p>
          </div>
        </div>

        <!-- Sessions Per Week -->
        <div class="mb-8">
          <div class="flex justify-between items-center mb-3">
            <label class="text-sm font-bold text-slate-300 uppercase tracking-wider">
              Training Sessions Per Week
            </label>
            <span id="sessions-display" class="text-lg text-neon-pink font-bold">4 sessions</span>
          </div>
          <input
            type="range"
            id="sessions-slider"
            min="2"
            max="7"
            value="4"
            class="w-full"
          />
          <div class="flex justify-between text-xs text-slate-500 mt-1">
            <span>2</span>
            <span>3</span>
            <span>4</span>
            <span>5</span>
            <span>6</span>
            <span>7</span>
          </div>
        </div>

        <!-- Available Time -->
        <div class="mb-8">
          <label class="block text-sm font-bold text-slate-300 uppercase tracking-wider mb-2">
            Available Training Time Per Week
          </label>
          <input
            type="text"
            id="available-time"
            placeholder="e.g., 5 hours"
            class="w-full p-3 rounded-xl bg-black/50 border border-white/10 text-white focus:ring-2 focus:ring-neon-pink focus:border-transparent transition outline-none"
          />
        </div>

        <!-- Additional Info -->
        <div class="mb-8">
          <label class="block text-sm font-bold text-slate-300 uppercase tracking-wider mb-2">
            Additional Information (Optional)
          </label>
          <textarea
            id="additional-info"
            placeholder="Any injuries, preferences, or constraints..."
            rows="3"
            class="w-full p-3 rounded-xl bg-black/50 border border-white/10 text-white focus:ring-2 focus:ring-neon-pink focus:border-transparent transition outline-none resize-none"
          ></textarea>
        </div>

        <!-- Create Button -->
        <button
          id="create-plan-btn"
          class="gradient-button w-full px-6 py-4 rounded-xl text-white text-lg font-black uppercase tracking-wider"
        >
          <i class="fas fa-magic mr-2"></i>
          Create My Training Plan
        </button>
      </div>
    </div>

    <!-- Main Content (Hidden until plan is created) -->
    <div id="main-content" class="hidden h-full flex flex-col p-6">
      <!-- Header -->
      <div class="flex items-center justify-between mb-6">
        <div>
          <h1 class="text-3xl font-black text-white uppercase tracking-wider">
            <i class="fa-solid fa-calendar-days text-neon-pink mr-2"></i>
            Your Training Plan
          </h1>
          <p id="plan-summary" class="text-slate-400 text-sm mt-1"></p>
        </div>
        <div class="flex gap-3">
          <button
            id="new-plan-btn"
            class="px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:border-neon-pink/50 transition text-sm font-semibold"
          >
            <i class="fas fa-plus mr-2"></i>New Plan
          </button>
          <a
            href="user.html"
            class="px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:border-neon-pink/50 transition text-sm font-semibold"
          >
            <i class="fas fa-arrow-left mr-2"></i>Dashboard
          </a>
        </div>
      </div>

      <!-- Toggle View Buttons -->
      <div class="flex gap-3 mb-6">
        <button
          id="text-view-btn"
          class="px-4 py-2 rounded-lg bg-neon-pink/20 border border-neon-pink/40 font-semibold text-sm"
        >
          <i class="fas fa-align-left mr-2"></i>Text View
        </button>
        <button
          id="calendar-view-btn"
          class="px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:border-neon-pink/50 transition font-semibold text-sm"
        >
          <i class="fas fa-calendar mr-2"></i>Calendar View
        </button>
      </div>

      <!-- Plan Display -->
      <div id="plan-display" class="flex-grow overflow-y-auto bg-black/20 rounded-2xl p-6 border border-white/10">
        <div id="text-view" class="plan-content"></div>
        <div id="calendar-view" class="hidden"></div>
      </div>
    </div>

    <script>
      let selectedSport = null;
      let trainingPlanData = null;

      // Sport selection
      document.querySelectorAll('.sport-card').forEach(card => {
        card.addEventListener('click', () => {
          document.querySelectorAll('.sport-card').forEach(c => c.classList.remove('selected'));
          card.classList.add('selected');
          selectedSport = card.dataset.sport;
        });
      });

      // Sessions slider
      const sessionsSlider = document.getElementById('sessions-slider');
      const sessionsDisplay = document.getElementById('sessions-display');
      sessionsSlider.addEventListener('input', (e) => {
        const value = e.target.value;
        sessionsDisplay.textContent = `${value} session${value > 1 ? 's' : ''}`;
      });

      // Create Plan Button
      document.getElementById('create-plan-btn').addEventListener('click', async () => {
        if (!selectedSport) {
          alert('Please select a sport');
          return;
        }

        const currentTime = document.getElementById('current-time').value.trim();
        const goalTime = document.getElementById('goal-time').value.trim();
        const sessions = sessionsSlider.value;
        const availableTime = document.getElementById('available-time').value.trim();
        const additionalInfo = document.getElementById('additional-info').value.trim();

        if (!currentTime || !goalTime || !availableTime) {
          alert('Please fill in all required fields');
          return;
        }

        // Build the prompt
        const prompt = `Please create a personalized training plan with the following details:

**Sport:** ${selectedSport.charAt(0).toUpperCase() + selectedSport.slice(1)}
**Current Performance:** ${currentTime}
**Goal:** ${goalTime}
**Training Frequency:** ${sessions} sessions per week
**Available Training Time:** ${availableTime} per week${additionalInfo ? `\n**Additional Information:** ${additionalInfo}` : ''}

Please provide:
1. A structured training plan (recommend appropriate duration: 6-12 weeks based on the goal)
2. Week-by-week breakdown with specific workouts
3. Each workout should include: Type, Duration, Intensity, and brief description
4. Include rest and recovery days
5. Progressive structure that builds toward the goal
6. Tips for successful training

Format the plan clearly with headers for each week and day.`;

        // Show loading state
        document.getElementById('create-plan-btn').innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Creating Your Plan...';
        document.getElementById('create-plan-btn').disabled = true;

        try {
          const response = await fetch('http://127.0.0.1:5500/api/training-plan', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ message: prompt }),
          });

          if (!response.ok) {
            throw new Error('Launch app.py');
          }

          const data = await response.json();
          trainingPlanData = data.response;

          // Hide wizard, show plan
          document.getElementById('wizard-overlay').classList.add('hidden');
          document.getElementById('main-content').classList.remove('hidden');

          // Display plan
          displayPlan(trainingPlanData);

          // Set summary
          document.getElementById('plan-summary').textContent = 
            `${selectedSport.charAt(0).toUpperCase() + selectedSport.slice(1)} • ${sessions} sessions/week • ${availableTime}`;

        } catch (error) {
          alert('Launch app.py');
          document.getElementById('create-plan-btn').innerHTML = '<i class="fas fa-magic mr-2"></i>Create My Training Plan';
          document.getElementById('create-plan-btn').disabled = false;
        }
      });

      // Display plan in text view
      function displayPlan(planText) {
        const textView = document.getElementById('text-view');
        const formattedText = planText
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/\n/g, '<br>');
        textView.innerHTML = formattedText;
      }

      // View toggle buttons
      document.getElementById('text-view-btn').addEventListener('click', () => {
        document.getElementById('text-view').classList.remove('hidden');
        document.getElementById('calendar-view').classList.add('hidden');
        document.getElementById('text-view-btn').classList.add('bg-neon-pink/20', 'border-neon-pink/40');
        document.getElementById('text-view-btn').classList.remove('bg-white/5', 'border-white/10');
        document.getElementById('calendar-view-btn').classList.remove('bg-neon-pink/20', 'border-neon-pink/40');
        document.getElementById('calendar-view-btn').classList.add('bg-white/5', 'border-white/10');
      });

      document.getElementById('calendar-view-btn').addEventListener('click', () => {
        document.getElementById('text-view').classList.add('hidden');
        document.getElementById('calendar-view').classList.remove('hidden');
        document.getElementById('calendar-view-btn').classList.add('bg-neon-pink/20', 'border-neon-pink/40');
        document.getElementById('calendar-view-btn').classList.remove('bg-white/5', 'border-white/10');
        document.getElementById('text-view-btn').classList.remove('bg-neon-pink/20', 'border-neon-pink/40');
        document.getElementById('text-view-btn').classList.add('bg-white/5', 'border-white/10');
        
        // Generate calendar view if not already done
        if (document.getElementById('calendar-view').innerHTML === '') {
          generateCalendarView(trainingPlanData);
        }
      });

      // Generate calendar view (simplified)
      function generateCalendarView(planText) {
        const calendarView = document.getElementById('calendar-view');
        calendarView.innerHTML = '<div class="text-center text-slate-400"><p class="text-lg">Calendar view coming soon!</p><p class="text-sm mt-2">Use Text View to see your complete training plan.</p></div>';
      }

      // New Plan button
      document.getElementById('new-plan-btn').addEventListener('click', () => {
        document.getElementById('wizard-overlay').classList.remove('hidden');
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('create-plan-btn').innerHTML = '<i class="fas fa-magic mr-2"></i>Create My Training Plan';
        document.getElementById('create-plan-btn').disabled = false;
      });
    </script>
  </body>
</html>
